<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –ò–ò –¢—Ä–µ–Ω–µ—Ä–∞</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #121212; color: white; }
        .block { border: 1px solid #333; padding: 15px; margin-bottom: 10px; border-radius: 8px; }
        button { cursor: pointer; padding: 10px; background: #007bff; color: white; border: none; border-radius: 5px; }
        input { padding: 10px; border-radius: 5px; border: 1px solid #444; background: #222; color: white; }
        #chat-log { height: 150px; overflow-y: auto; background: #000; padding: 10px; margin-top: 10px; border-radius: 5px; font-size: 14px; }
        .status { font-size: 12px; color: #888; margin-bottom: 5px; }
    </style>
</head>
<body>

    <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –¢–µ—Å—Ç</h2>
    
    <div class="block">
        <label>–í–µ—Å (–∫–≥): </label>
        <input type="number" id="userWeight" value="80">
    </div>

    <div class="block">
        <h3>üíä –†–∞—Å—á–µ—Ç –¥–æ–±–∞–≤–∫–∏ (–¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã)</h3>
        <button onclick="getSupps()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ö—Ä–µ–∞—Ç–∏–Ω</button>
        <p id="supps-out">–¢—É—Ç –±—É–¥–µ—Ç –æ—Ç–≤–µ—Ç...</p>
    </div>

    <div class="block">
        <h3>üí¨ –ß–∞—Ç —Å —Ç—Ä–µ–Ω–µ—Ä–æ–º (–û–±—â–µ–Ω–∏–µ)</h3>
        <div id="chat-log"></div>
        <br>
        <input type="text" id="chatInput" placeholder="–°–ø—Ä–æ—Å–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å..." style="width: 70%;">
        <button onclick="sendChatMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <script>
        // –í–°–¢–ê–í–¨ –°–í–û–Æ –°–°–´–õ–ö–£ –¢–£–¢ (–±–µ–∑ /v1/chat/completions –Ω–∞ –∫–æ–Ω—Ü–µ, –º—ã –¥–æ–±–∞–≤–∏–º –µ—ë –Ω–∏–∂–µ)
        const BASE_URL = "https://g0qjt7-5-228-114-75.ru.tuna.am"; 
        const MODEL = "mistralai/mistral-3-3b";

        async function callAI(systemPrompt, userMessage) {
            try {
                const response = await fetch(`${BASE_URL}/v1/chat/completions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: userMessage }
                        ],
                        temperature: 0.3
                    })
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                const data = await response.json();
                return data.choices[0].message.content;
            } catch (err) {
                console.error(err);
                return "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: –ø—Ä–æ–≤–µ—Ä—å Tuna –∏ LM Studio!";
            }
        }

        // –õ–æ–≥–∏–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–æ–∫ (–°—É—Ö–æ–π –æ—Ç–≤–µ—Ç)
        async function getSupps() {
            const weight = document.getElementById('userWeight').value;
            const out = document.getElementById('supps-out');
            out.innerText = "–ò–ò —Å—á–∏—Ç–∞–µ—Ç...";
            
            const sys = "–¢—ã ‚Äî –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä. –í—ã–¥–∞–π —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–∫–∏ –∏ –¥–æ–∑–∏—Ä–æ–≤–∫—É —Ü–∏—Ñ—Ä–∞–º–∏. –ë–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.";
            const msg = `–†–∞—Å—Å—á–∏—Ç–∞–π –¥–æ–∑—É –∫—Ä–µ–∞—Ç–∏–Ω–∞ –¥–ª—è —á–µ–ª–æ–≤–µ–∫–∞ –≤–µ—Å–æ–º ${weight} –∫–≥.`;
            
            out.innerText = await callAI(sys, msg);
        }

        // –õ–æ–≥–∏–∫–∞ –¥–ª—è —á–∞—Ç–∞ (–ñ–∏–≤–æ–µ –æ–±—â–µ–Ω–∏–µ)
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const log = document.getElementById('chat-log');
            const weight = document.getElementById('userWeight').value;
            
            if (!input.value) return;

            log.innerHTML += `<div><b>–í—ã:</b> ${input.value}</div>`;
            const userText = input.value;
            input.value = "";

            const sys = `–¢—ã ‚Äî –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π —Ñ–∏—Ç–Ω–µ—Å-—Ç—Ä–µ–Ω–µ—Ä. –£ —Ç–≤–æ–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤–µ—Å ${weight}–∫–≥. –û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ.`;
            
            const aiResponse = await callAI(sys, userText);
            log.innerHTML += `<div style="color: #00ff00"><b>–¢—Ä–µ–Ω–µ—Ä:</b> ${aiResponse}</div>`;
            log.scrollTop = log.scrollHeight;
        }
    </script>
</body>
</html>
