<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>Sports Analyzer Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3390ec;
            --primary-dark: #2481cc;
            --secondary: #34c759;
            --accent: #ff3b30;
            --warning: #ff9500;
            --success: #30d158;
            --light-bg: #f2f2f7;
            --dark-bg: #1c1c1e;
            --card-bg: #ffffff;
            --text: #000000;
            --text-light: #8e8e93;
            --border: #c7c7cc;
            --shadow: 0 2px 8px rgba(0,0,0,0.08);
            --radius: 14px;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: var(--light-bg);
            color: var(--text);
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }

        .safe-top {
            height: var(--safe-top);
            background: var(--primary);
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            min-height: calc(100vh - var(--safe-top) - var(--safe-bottom));
            padding-bottom: var(--safe-bottom);
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header i {
            font-size: 24px;
            background: rgba(255,255,255,0.15);
            padding: 8px;
            border-radius: 10px;
            min-width: 40px;
            text-align: center;
        }

        .header-content {
            flex: 1;
        }

        .header h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .header .subtitle {
            opacity: 0.9;
            font-size: 13px;
        }

        .user-info {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .user-badge {
            background: rgba(255,255,255,0.15);
            padding: 4px 10px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
        }

        .main-content {
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding-bottom: 80px;
        }

        /* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: 16px;
        }

        .welcome-message {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            border-left: 4px solid var(--secondary);
            box-shadow: var(--shadow);
        }

        .alert {
            padding: 14px;
            border-radius: var(--radius);
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .alert-warning {
            background: #fff9e6;
            border: 1px solid #ffd700;
            color: #8a6d3b;
        }

        .alert-success {
            background: #e8f5e9;
            border: 1px solid #34c759;
            color: #2d8519;
        }

        /* –ö–Ω–æ–ø–∫–∏ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .menu-btn {
            background: var(--card-bg);
            border: none;
            padding: 20px 12px;
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: var(--shadow);
            min-height: 100px;
            position: relative;
        }

        .menu-btn i {
            font-size: 28px;
            color: var(--primary);
            margin-bottom: 4px;
        }

        .menu-btn span {
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            line-height: 1.3;
        }

        .menu-btn .badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--accent);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }

        .sport-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .sport-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px 12px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: transform 0.2s;
            border: 1px solid var(--border);
            cursor: pointer;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .sport-card i {
            font-size: 32px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .sport-card h3 {
            font-size: 15px;
            margin-bottom: 6px;
        }

        .sport-card p {
            font-size: 12px;
            color: var(--text-light);
            line-height: 1.3;
        }

        /* –¢–µ—Å—Ç–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã */
        .test-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin: 16px 0;
        }

        .test-step {
            background: #f9f9f9;
            padding: 20px;
            border-radius: var(--radius);
            margin: 12px 0;
        }

        .input-group {
            margin: 16px 0;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
            font-size: 14px;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.2s;
            background: white;
        }

        .test-area {
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            margin: 16px 0;
            text-align: center;
        }

        .test-target {
            width: 80px;
            height: 80px;
            background: var(--accent);
            border-radius: 50%;
            margin: 16px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: white;
            user-select: none;
            touch-action: manipulation;
        }

        .test-timer {
            font-size: 32px;
            font-weight: bold;
            margin: 20px 0;
            color: var(--primary);
            text-align: center;
        }

        .test-results {
            background: rgba(0,0,0,0.03);
            padding: 16px;
            border-radius: var(--radius);
            margin: 16px 0;
        }

        .score-display {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 10px 0;
        }

        .progress-bar {
            height: 8px;
            background: var(--light-bg);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--secondary), var(--primary));
            border-radius: 4px;
            transition: width 1s ease;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 15px;
            min-height: 48px;
            width: 100%;
            margin: 4px 0;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: #e8e8ed;
            color: var(--text);
        }

        .btn-accent {
            background: var(--accent);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .navigation {
            display: flex;
            gap: 8px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .navigation .btn {
            flex: 1;
            min-width: 120px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 16px 0;
        }

        .stat-card {
            background: white;
            padding: 16px;
            border-radius: var(--radius);
            text-align: center;
            box-shadow: var(--shadow);
            border-top: 4px solid var(--primary);
        }

        .analysis-card {
            background: #f8f9fa;
            padding: 16px;
            border-radius: var(--radius);
            margin: 12px 0;
            border-left: 4px solid var(--primary);
        }

        /* –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 8px 16px;
            padding-bottom: calc(8px + var(--safe-bottom));
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .nav-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 8px 4px;
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 11px;
            cursor: pointer;
            transition: color 0.2s;
            min-height: 48px;
        }

        .nav-btn.active {
            color: var(--primary);
        }

        .nav-btn i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
        .menu-btn:active,
        .sport-card:active {
            transform: scale(0.98);
            background: #f0f0f5;
        }

        .hidden {
            display: none !important;
        }

        @media (min-width: 768px) {
            .container {
                max-width: 500px;
                margin: 0 auto;
                border-left: 1px solid var(--border);
                border-right: 1px solid var(--border);
            }
            
            .menu-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .sport-cards {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 320px) {
            .menu-btn span {
                font-size: 12px;
            }
            
            .sport-card {
                padding: 16px 8px;
            }
        }

        /* –î–ª—è —Ç–µ—Å—Ç–æ–≤ */
        .coordination-area {
            width: 100%;
            height: 200px;
            background: rgba(0,0,0,0.05);
            border-radius: var(--radius);
            position: relative;
            margin: 16px 0;
            overflow: hidden;
        }

        .moving-target {
            width: 60px;
            height: 60px;
            background: var(--accent);
            border-radius: 50%;
            position: absolute;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.1s;
            user-select: none;
        }

        .sequence-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 16px 0;
        }

        .sequence-box {
            width: 100%;
            height: 80px;
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 24px;
            user-select: none;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 16px 0;
        }

        .option-btn {
            padding: 16px;
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .option-btn.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .scenario-option {
            padding: 16px;
            background: white;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            margin: 8px 0;
        }

        .scenario-option.selected {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
    </style>
</head>
<body>
    <div class="safe-top"></div>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="page-welcome" class="page active">
            <div class="header">
                <i class="fas fa-running"></i>
                <div class="header-content">
                    <h1>Sports Analyzer Pro</h1>
                    <div class="subtitle">–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</div>
                </div>
                <div class="user-info">
                    <div class="user-badge">
                        <i class="fas fa-user"></i>
                        <span id="user-name">–ì–æ—Å—Ç—å</span>
                    </div>
                    <div class="user-badge">
                        <i class="fas fa-chart-line"></i>
                        <span id="user-score">–ù–µ –æ—Ü–µ–Ω–µ–Ω</span>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="welcome-banner">
                    <h2><i class="fas fa-bullseye"></i> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                    <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π</p>
                </div>

                <div class="alert alert-warning" id="initial-test-alert">
                    <i class="fas fa-exclamation-circle"></i>
                    <div>
                        <strong>–î–ª—è –Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç</strong>
                        <p>–≠—Ç–æ –∑–∞–π–º–µ—Ç 10-15 –º–∏–Ω—É—Ç</p>
                    </div>
                </div>

                <div class="welcome-message">
                    <h3><i class="fas fa-flask"></i> –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?</h3>
                    <p style="margin-top: 8px;">–ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã:</p>
                    
                    <div class="stats-grid" style="margin-top: 16px;">
                        <div class="stat-card">
                            <i class="fas fa-stopwatch" style="font-size: 24px; color: var(--primary);"></i>
                            <h4>–§–∏–∑–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã</h4>
                            <p style="font-size: 12px;">–ó–∞–º–µ—Ä—ã –≤—Ä–µ–º–µ–Ω–∏, —Ä–µ–∞–∫—Ü–∏–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-brain" style="font-size: 24px; color: var(--primary);"></i>
                            <h4>–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã</h4>
                            <p style="font-size: 12px;">–°—Ç—Ä–∞—Ç–µ–≥–∏—è, –ª–æ–≥–∏–∫–∞, –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π</p>
                        </div>
                    </div>
                    
                    <div class="menu-grid" style="margin-top: 20px;">
                        <button class="menu-btn" onclick="startComprehensiveTest()">
                            <i class="fas fa-play-circle"></i>
                            <span>–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑</span>
                            <div class="badge">üöÄ</div>
                        </button>
                        
                        <button class="menu-btn" onclick="showPage('my-results')">
                            <i class="fas fa-chart-bar"></i>
                            <span>–ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
                            <div class="badge">üìä</div>
                        </button>
                        
                        <button class="menu-btn" onclick="showPage('sports')">
                            <i class="fas fa-futbol"></i>
                            <span>–í–∏–¥—ã —Å–ø–æ—Ä—Ç–∞</span>
                            <div class="badge">üéØ</div>
                        </button>
                        
                        <button class="menu-btn" onclick="showPage('mini-games')">
                            <i class="fas fa-gamepad"></i>
                            <span>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</span>
                            <div class="badge">üéÆ</div>
                        </button>
                    </div>
                </div>

                <div class="welcome-message">
                    <h3><i class="fas fa-chart-line"></i> –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø</h3>
                    <div class="sport-cards">
                        <button class="sport-card" onclick="selectSport('football')">
                            <i class="fas fa-futbol"></i>
                            <h3>–§—É—Ç–±–æ–ª</h3>
                            <p>8 –ø–æ–∑–∏—Ü–∏–π</p>
                        </button>
                        
                        <button class="sport-card" onclick="selectSport('basketball')">
                            <i class="fas fa-basketball-ball"></i>
                            <h3>–ë–∞—Å–∫–µ—Ç–±–æ–ª</h3>
                            <p>5 –ø–æ–∑–∏—Ü–∏–π</p>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í—ã–±–æ—Ä —Å–ø–æ—Ä—Ç–∞ -->
        <div id="page-sports" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="showPage('welcome')" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1>–í—ã–±–æ—Ä –≤–∏–¥–∞ —Å–ø–æ—Ä—Ç–∞</h1>
                    <div class="subtitle">–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="welcome-message">
                    <h3><i class="fas fa-futbol"></i> –í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞</h3>
                    <p>–ú—ã –ø–æ–¥–±–µ—Ä–µ–º –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –∏ –¥–∞–¥–∏–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</p>
                </div>

                <div class="sport-cards">
                    <button class="sport-card" onclick="selectSport('football')">
                        <i class="fas fa-futbol"></i>
                        <h3>–§—É—Ç–±–æ–ª</h3>
                        <p>8 –ø–æ–∑–∏—Ü–∏–π, —Å–∫–æ—Ä–æ—Å—Ç—å, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</p>
                    </button>
                    
                    <button class="sport-card" onclick="selectSport('basketball')">
                        <i class="fas fa-basketball-ball"></i>
                        <h3>–ë–∞—Å–∫–µ—Ç–±–æ–ª</h3>
                        <p>5 –ø–æ–∑–∏—Ü–∏–π, –ø—Ä—ã–≥—É—á–µ—Å—Ç—å, —Ç–æ—á–Ω–æ—Å—Ç—å</p>
                    </button>
                    
                    <button class="sport-card" onclick="selectSport('volleyball')">
                        <i class="fas fa-volleyball-ball"></i>
                        <h3>–í–æ–ª–µ–π–±–æ–ª</h3>
                        <p>6 –ø–æ–∑–∏—Ü–∏–π, —Ä–µ–∞–∫—Ü–∏—è, –ø—Ä—ã–≥—É—á–µ—Å—Ç—å</p>
                    </button>
                    
                    <button class="sport-card" onclick="selectSport('tennis')">
                        <i class="fas fa-table-tennis"></i>
                        <h3>–¢–µ–Ω–Ω–∏—Å</h3>
                        <p>4 —Å—Ç–∏–ª—è, —Ä–µ–∞–∫—Ü–∏—è, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å</p>
                    </button>
                    
                    <button class="sport-card" onclick="selectSport('hockey')">
                        <i class="fas fa-hockey-puck"></i>
                        <h3>–•–æ–∫–∫–µ–π</h3>
                        <p>4 –∞–º–ø–ª—É–∞, —Å–∫–æ—Ä–æ—Å—Ç—å, —Å–∏–ª–∞</p>
                    </button>
                    
                    <button class="sport-card" onclick="selectSport('swimming')">
                        <i class="fas fa-swimmer"></i>
                        <h3>–ü–ª–∞–≤–∞–Ω–∏–µ</h3>
                        <p>4 —Å—Ç–∏–ª—è, –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å, —Ç–µ—Ö–Ω–∏–∫–∞</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç -->
        <div id="page-comprehensive-test" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="backToWelcome()" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1 id="test-title">–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç</h1>
                    <div class="subtitle" id="test-progress">–®–∞–≥ 1 –∏–∑ 9</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="test-container">
                    <!-- –®–∞–≥ 1: –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                    <div id="test-step-1" class="test-step">
                        <h3><i class="fas fa-user"></i> –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h3>
                        <div class="input-group">
                            <label class="input-label">–í–∞—à–µ –∏–º—è:</label>
                            <input type="text" class="input-field" id="user-name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
                        </div>
                        <div class="input-group">
                            <label class="input-label">–í–æ–∑—Ä–∞—Å—Ç:</label>
                            <input type="number" class="input-field" id="user-age" min="10" max="70" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç">
                        </div>
                        <div class="input-group">
                            <label class="input-label">–†–æ—Å—Ç (—Å–º):</label>
                            <input type="number" class="input-field" id="user-height" min="100" max="220" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 180">
                        </div>
                        <div class="input-group">
                            <label class="input-label">–í–µ—Å (–∫–≥):</label>
                            <input type="number" class="input-field" id="user-weight" min="30" max="150" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 75">
                        </div>
                    </div>

                    <!-- –®–∞–≥ 2: –¢–µ—Å—Ç –∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ -->
                    <div id="test-step-2" class="test-step hidden">
                        <h3><i class="fas fa-eye"></i> –¢–µ—Å—Ç –∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏</h3>
                        <p style="margin: 12px 0; color: var(--text-light);">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–≥, –∫–æ–≥–¥–∞ –æ–Ω –ø–æ—è–≤–∏—Ç—Å—è</p>
                        
                        <div class="test-area">
                            <div id="visual-reaction-target" class="test-target disabled" onclick="recordVisualReaction()">
                                –ñ–ú–ò!
                            </div>
                            <div class="test-timer" id="visual-reaction-timer">‚Äî</div>
                            <div class="test-results hidden" id="visual-reaction-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                                <div id="visual-reaction-times"></div>
                                <div>–°—Ä–µ–¥–Ω–µ–µ: <span id="avg-visual-reaction">0</span> –º—Å</div>
                                <div class="score-display" id="visual-reaction-score">0/10</div>
                            </div>
                            <button id="start-visual-reaction" class="btn btn-primary" onclick="startVisualReactionTest()">
                                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                            </button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 3: –¢–µ—Å—Ç —Å–ª—É—Ö–æ–≤–æ–π —Ä–µ–∞–∫—Ü–∏–∏ -->
                    <div id="test-step-3" class="test-step hidden">
                        <h3><i class="fas fa-ear-listen"></i> –¢–µ—Å—Ç —Å–ª—É—Ö–æ–≤–æ–π —Ä–µ–∞–∫—Ü–∏–∏</h3>
                        <p style="margin: 12px 0; color: var(--text-light);">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ —É—Å–ª—ã—à–∏—Ç–µ –∑–≤—É–∫</p>
                        
                        <div class="test-area">
                            <div class="test-timer" id="sound-reaction-timer">–ñ–¥–∏—Ç–µ –∑–≤—É–∫–∞...</div>
                            <button id="sound-reaction-button" class="btn btn-accent" onclick="recordSoundReaction()">
                                –ù–∞–∂–º–∏—Ç–µ –ø—Ä–∏ –∑–≤—É–∫–µ
                            </button>
                            <div class="test-results hidden" id="sound-reaction-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                                <div id="sound-reaction-times"></div>
                                <div>–°—Ä–µ–¥–Ω–µ–µ: <span id="avg-sound-reaction">0</span> –º—Å</div>
                                <div class="score-display" id="sound-reaction-score">0/10</div>
                            </div>
                            <button id="start-sound-reaction" class="btn btn-primary" onclick="startSoundReactionTest()">
                                <i class="fas fa-volume-up"></i> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                            </button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 4: –¢–µ—Å—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ -->
                    <div id="test-step-4" class="test-step hidden">
                        <h3><i class="fas fa-crosshairs"></i> –¢–µ—Å—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏</h3>
                        <p style="margin: 12px 0; color: var(--text-light);">–£–¥–µ—Ä–∂–∏–≤–∞–π—Ç–µ –∫—É—Ä—Å–æ—Ä –≤–Ω—É—Ç—Ä–∏ –¥–≤–∏–∂—É—â–µ–≥–æ—Å—è –∫—Ä—É–≥–∞</p>
                        
                        <div class="test-area">
                            <div class="coordination-area" id="coordination-area">
                                <div id="coordination-target" class="moving-target"></div>
                            </div>
                            <div class="test-timer" id="coordination-timer">0.0 —Å–µ–∫</div>
                            <div class="test-results hidden" id="coordination-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                                <div>–í—Ä–µ–º—è: <span id="coordination-time">0</span> —Å–µ–∫</div>
                                <div>–¢–æ—á–Ω–æ—Å—Ç—å: <span id="coordination-accuracy">0</span>%</div>
                                <div class="score-display" id="coordination-score">0/10</div>
                            </div>
                            <button id="start-coordination" class="btn btn-primary" onclick="startCoordinationTest()">
                                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                            </button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 5: –¢–µ—Å—Ç –ø–∞–º—è—Ç–∏ -->
                    <div id="test-step-5" class="test-step hidden">
                        <h3><i class="fas fa-brain"></i> –¢–µ—Å—Ç –ø–∞–º—è—Ç–∏</h3>
                        <p style="margin: 12px 0; color: var(--text-light);">–ó–∞–ø–æ–º–Ω–∏—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–≤–µ—Ç–æ–≤</p>
                        
                        <div class="test-area">
                            <div class="sequence-grid" id="sequence-grid">
                                <div class="sequence-box" style="background: #ff6b6b;" onclick="checkSequenceAnswer(this, 1)">1</div>
                                <div class="sequence-box" style="background: #4ecdc4;" onclick="checkSequenceAnswer(this, 2)">2</div>
                                <div class="sequence-box" style="background: #ffd166;" onclick="checkSequenceAnswer(this, 3)">3</div>
                                <div class="sequence-box" style="background: #06d6a0;" onclick="checkSequenceAnswer(this, 4)">4</div>
                                <div class="sequence-box" style="background: #118ab2;" onclick="checkSequenceAnswer(this, 5)">5</div>
                                <div class="sequence-box" style="background: #9d4edd;" onclick="checkSequenceAnswer(this, 6)">6</div>
                            </div>
                            <div class="test-timer" id="sequence-timer">‚Äî</div>
                            <div class="test-results hidden" id="sequence-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                                <div>–ü—Ä–∞–≤–∏–ª—å–Ω–æ: <span id="sequence-correct">0</span>/5</div>
                                <div>–î–ª–∏–Ω–∞: <span id="sequence-length">0</span></div>
                                <div class="score-display" id="sequence-score">0/10</div>
                            </div>
                            <button id="start-sequence" class="btn btn-primary" onclick="startSequenceTest()">
                                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                            </button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 6: –¢–µ—Å—Ç –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏ -->
                    <div id="test-step-6" class="test-step hidden">
                        <h3><i class="fas fa-tasks"></i> –¢–µ—Å—Ç –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏</h3>
                        <p style="margin: 12px 0; color: var(--text-light);">–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –ø–æ—è–≤–ª—è—é—â–∏–º—Å—è —Ü–µ–ª—è–º –∑–∞ 30 —Å–µ–∫—É–Ω–¥</p>
                        
                        <div class="test-area">
                            <div class="coordination-area" id="multi-task-area"></div>
                            <div style="display: flex; justify-content: space-between; margin: 16px 0;">
                                <div>–ü–æ–ø–∞–¥–∞–Ω–∏–π: <span id="targets-hit">0</span></div>
                                <div>–í—Ä–µ–º—è: <span id="multi-task-timer">30</span> —Å–µ–∫</div>
                            </div>
                            <div class="test-results hidden" id="multi-task-results">
                                <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                                <div>–ü–æ–ø–∞–¥–∞–Ω–∏–π: <span id="multi-task-hit">0</span></div>
                                <div>–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏: <span id="multi-task-avg-time">0</span> –º—Å</div>
                                <div class="score-display" id="multi-task-score">0/10</div>
                            </div>
                            <button id="start-multi-task" class="btn btn-primary" onclick="startMultiTaskTest()">
                                <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                            </button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 7: –°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è -->
                    <div id="test-step-7" class="test-step hidden">
                        <h3><i class="fas fa-heart"></i> –ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è</h3>
                        <p style="margin: 12px 0;">–ö–∞–∫–∏–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞ –≤–∞–º –Ω—Ä–∞–≤—è—Ç—Å—è?</p>
                        
                        <div class="options-grid">
                            <button class="option-btn" onclick="toggleOption(this, 'football')">‚öΩ –§—É—Ç–±–æ–ª</button>
                            <button class="option-btn" onclick="toggleOption(this, 'basketball')">üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª</button>
                            <button class="option-btn" onclick="toggleOption(this, 'volleyball')">üèê –í–æ–ª–µ–π–±–æ–ª</button>
                            <button class="option-btn" onclick="toggleOption(this, 'tennis')">üéæ –¢–µ–Ω–Ω–∏—Å</button>
                            <button class="option-btn" onclick="toggleOption(this, 'hockey')">üèí –•–æ–∫–∫–µ–π</button>
                            <button class="option-btn" onclick="toggleOption(this, 'swimming')">üèä –ü–ª–∞–≤–∞–Ω–∏–µ</button>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 8: –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç -->
                    <div id="test-step-8" class="test-step hidden">
                        <h3><i class="fas fa-brain"></i> –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç</h3>
                        <p style="margin: 12px 0;">–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –≤ —Å–ø–æ—Ä—Ç–µ</p>
                        
                        <div id="psych-test-container"></div>
                        
                        <div id="psych-test-results" class="test-results hidden">
                            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                            <div id="psych-scores"></div>
                        </div>
                    </div>

                    <!-- –®–∞–≥ 9: –¢–µ—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π -->
                    <div id="test-step-9" class="test-step hidden">
                        <h3><i class="fas fa-chess"></i> –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π</h3>
                        <p style="margin: 12px 0;">–í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (5 –≤–æ–ø—Ä–æ—Å–æ–≤)</p>
                        
                        <div id="decision-test-container"></div>
                        
                        <div id="decision-test-results" class="test-results hidden">
                            <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h4>
                            <div id="decision-scores"></div>
                        </div>
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevTestStep()" id="prev-btn">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                    </button>
                    <button class="btn btn-primary" onclick="nextTestStep()" id="next-btn">
                        <i class="fas fa-arrow-right"></i> –î–∞–ª–µ–µ
                    </button>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ -->
        <div id="page-results" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="showPage('welcome')" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h1>
                    <div class="subtitle">–í–∞—à —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="test-container">
                    <h2><i class="fas fa-trophy"></i> –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h2>
                    
                    <div class="analysis-card">
                        <h3><i class="fas fa-user-circle"></i> –ü—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞</h3>
                        <div id="athlete-profile"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-chart-line"></i> –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</h3>
                        <div id="physical-stats"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-brain"></i> –ö–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏</h3>
                        <div id="cognitive-stats"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-chess"></i> –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ø–æ—Ä—Ç—Ä–µ—Ç</h3>
                        <div id="psychological-profile"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-medal"></i> –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞</h3>
                        <div id="sport-recommendations"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-bullseye"></i> –ò–¥–µ–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏</h3>
                        <div id="position-recommendations"></div>
                    </div>

                    <div class="analysis-card">
                        <h3><i class="fas fa-dumbbell"></i> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é</h3>
                        <div id="development-plan"></div>
                    </div>

                    <div class="navigation">
                        <button class="btn btn-primary" onclick="saveResults()">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                        <button class="btn btn-warning" onclick="restartTest()">
                            <i class="fas fa-redo"></i> –ó–∞–Ω–æ–≤–æ
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('welcome')">
                            <i class="fas fa-home"></i> –ù–∞ –≥–ª–∞–≤–Ω—É—é
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–∏–Ω–∏-–∏–≥—Ä—ã -->
        <div id="page-mini-games" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="showPage('welcome')" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1>–¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∏–≥—Ä—ã</h1>
                    <div class="subtitle">–†–∞–∑–≤–∏–≤–∞–π—Ç–µ –Ω–∞–≤—ã–∫–∏ —á–µ—Ä–µ–∑ –∏–≥—Ä—ã</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="welcome-message">
                    <h3><i class="fas fa-gamepad"></i> –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∏–≥—Ä—ã</h3>
                    <p>–†–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –Ω–∞–≤—ã–∫–∏ —á–µ—Ä–µ–∑ –∏–≥—Ä—ã!</p>
                </div>

                <div class="sport-cards">
                    <button class="sport-card" onclick="startReactionGame()">
                        <i class="fas fa-bolt"></i>
                        <h3>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏</h3>
                        <p>–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —Ü–µ–ª—è–º</p>
                    </button>
                    
                    <button class="sport-card" onclick="startCoordinationGame()">
                        <i class="fas fa-crosshairs"></i>
                        <h3>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è</h3>
                        <p>–ü–æ–ø–∞–¥–∞–π—Ç–µ –≤ —Ü–µ–ª–∏</p>
                    </button>
                    
                    <button class="sport-card" onclick="startMemoryGame()">
                        <i class="fas fa-brain"></i>
                        <h3>–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è –ø–∞–º—è—Ç—å</h3>
                        <p>–ó–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</p>
                    </button>
                    
                    <button class="sport-card" onclick="startStrategyGame()">
                        <i class="fas fa-chess"></i>
                        <h3>–¢–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –º—ã—à–ª–µ–Ω–∏–µ</h3>
                        <p>–†–µ—à–∞–π—Ç–µ –∑–∞–¥–∞—á–∏</p>
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="page-my-results" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="showPage('welcome')" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1>–ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h1>
                    <div class="subtitle">–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="test-container">
                    <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤</h2>
                    
                    <div id="results-history">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <div class="navigation" style="margin-top: 20px;">
                        <button class="btn btn-secondary" onclick="showPage('welcome')">
                            <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
                        </button>
                        <button class="btn btn-primary" onclick="startComprehensiveTest()">
                            <i class="fas fa-redo"></i> –ù–æ–≤—ã–π —Ç–µ—Å—Ç
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ê–Ω–∞–ª–∏–∑ –ø–æ –≤–∏–¥—É —Å–ø–æ—Ä—Ç–∞ -->
        <div id="page-sport-analysis" class="page">
            <div class="header">
                <i class="fas fa-arrow-left" onclick="showPage('welcome')" style="cursor: pointer;"></i>
                <div class="header-content">
                    <h1 id="sport-analysis-title">–ê–Ω–∞–ª–∏–∑ —Å–ø–æ—Ä—Ç–∞</h1>
                    <div class="subtitle">–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑</div>
                </div>
                <div style="width: 40px;"></div>
            </div>

            <div class="main-content">
                <div class="test-container">
                    <div id="sport-analysis-content">
                        <!-- –ê–Ω–∞–ª–∏–∑ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-page="welcome">
            <i class="fas fa-home"></i>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-btn" data-page="sports">
            <i class="fas fa-futbol"></i>
            <span>–°–ø–æ—Ä—Ç</span>
        </button>
        <button class="nav-btn" data-page="comprehensive-test">
            <i class="fas fa-play"></i>
            <span>–¢–µ—Å—Ç</span>
        </button>
        <button class="nav-btn" data-page="my-results">
            <i class="fas fa-chart-bar"></i>
            <span>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã</span>
        </button>
        <button class="nav-btn" data-page="mini-games">
            <i class="fas fa-gamepad"></i>
            <span>–ò–≥—Ä—ã</span>
        </button>
    </div>

    <script>
        // Telegram Web App Integration
        let tg = window.Telegram?.WebApp;
        
        if (tg) {
            tg.expand();
            tg.enableClosingConfirmation();
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã Telegram
            const buttonColor = tg.themeParams.button_color || '#3390ec';
            document.documentElement.style.setProperty('--primary', buttonColor);
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            if (tg.initDataUnsafe?.user) {
                const user = tg.initDataUnsafe.user;
                document.getElementById('user-name').textContent = user.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
            }
        }

        // –î–∞–Ω–Ω—ã–µ —Å–ø–æ—Ä—Ç–∞ (—Å–æ–∫—Ä–∞—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
        const SPORTS_DATA = {
            football: {
                name: "‚öΩ –§—É—Ç–±–æ–ª",
                positions: [
                    { name: "–í—Ä–∞—Ç–∞—Ä—å", requirements: { reaction: 9, coordination: 7 } },
                    { name: "–ó–∞—â–∏—Ç–Ω–∏–∫", requirements: { strength: 9 } },
                    { name: "–ü–æ–ª—É–∑–∞—â–∏—Ç–Ω–∏–∫", requirements: { stamina: 9 } },
                    { name: "–ù–∞–ø–∞–¥–∞—é—â–∏–π", requirements: { speed: 9 } }
                ]
            },
            basketball: {
                name: "üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª",
                positions: [
                    { name: "–†–∞–∑—ã–≥—Ä—ã–≤–∞—é—â–∏–π", requirements: { passing: 9 } },
                    { name: "–ê—Ç–∞–∫—É—é—â–∏–π –∑–∞—â–∏—Ç–Ω–∏–∫", requirements: { shooting: 9 } },
                    { name: "–¶–µ–Ω—Ç—Ä–æ–≤–æ–π", requirements: { height: 9 } }
                ]
            }
        };

        // –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã
        const PSYCH_QUESTIONS = [
            {
                question: "–ö–∞–∫ –≤—ã —Ä–µ–∞–≥–∏—Ä—É–µ—Ç–µ –Ω–∞ –∫—Ä–∏—Ç–∏–∫—É —Ç—Ä–µ–Ω–µ—Ä–∞?",
                options: [
                    { text: "–†–∞—Å—Å—Ç—Ä–∞–∏–≤–∞—é—Å—å", scores: { resilience: 2, confidence: 3 } },
                    { text: "–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏ –∏—Å–ø—Ä–∞–≤–ª—è—é", scores: { resilience: 8, confidence: 7 } }
                ]
            }
        ];

        // –í–æ–ø—Ä–æ—Å—ã –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
        const DECISION_QUESTIONS = [
            {
                question: "–§—É—Ç–±–æ–ª: –ó–∞ 5 –º–∏–Ω—É—Ç –¥–æ –∫–æ–Ω—Ü–∞ –≤–µ–¥–µ—Ç–µ 1:0. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è?",
                options: [
                    { text: "–ê—Ç–∞–∫–æ–≤–∞—Ç—å", score: 4 },
                    { text: "–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –º—è—á", score: 9 }
                ]
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let currentState = {
            currentPage: 'welcome',
            currentStep: 1,
            totalSteps: 9,
            testData: {
                personal: {},
                testResults: {
                    visualReaction: { times: [], average: 0, score: 0 },
                    soundReaction: { times: [], average: 0, score: 0 },
                    coordination: { time: 0, accuracy: 0, score: 0 },
                    sequence: { correct: 0, length: 0, score: 0 },
                    multiTask: { hits: 0, avgTime: 0, score: 0 },
                    decision: { answers: [], score: 0 }
                },
                psychResults: {},
                preferences: []
            },
            testHistory: [],
            currentSport: null
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
            loadFromStorage();
            updateUserDisplay();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤
            initPsychTest();
            initDecisionTest();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            initNavigation();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            showPage(currentState.currentPage);
        }

        function loadFromStorage() {
            const savedData = localStorage.getItem('sportsAnalyzerData');
            if (savedData) {
                const data = JSON.parse(savedData);
                currentState.testHistory = data.testHistory || [];
                
                if (data.lastTest) {
                    document.getElementById('user-score').textContent = 
                        `${data.lastTest.overallScore || 0}/100`;
                    document.getElementById('initial-test-alert').style.display = 'none';
                }
            }
        }

        function updateUserDisplay() {
            const name = localStorage.getItem('userName') || '–ì–æ—Å—Ç—å';
            document.getElementById('user-name').textContent = name;
        }

        function initNavigation() {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });
        }

        function showPage(pageId) {
            // –û–±–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            currentState.currentPage = pageId;
            
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const pageElement = document.getElementById(`page-${pageId}`);
            if (pageElement) {
                pageElement.classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-page') === pageId) {
                    btn.classList.add('active');
                }
            });
            
            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–≤–µ—Ä—Ö
            window.scrollTo(0, 0);
        }

        function backToWelcome() {
            showPage('welcome');
        }

        function showSportsSelection() {
            showPage('sports');
        }

        function showMiniGames() {
            showPage('mini-games');
        }

        function showMyResults() {
            showPage('my-results');
            displayTestHistory();
        }

        // –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ç–µ—Å—Ç
        function startComprehensiveTest() {
            currentState.currentStep = 1;
            currentState.testData = {
                personal: {},
                testResults: {
                    visualReaction: { times: [], average: 0, score: 0 },
                    soundReaction: { times: [], average: 0, score: 0 },
                    coordination: { time: 0, accuracy: 0, score: 0 },
                    sequence: { correct: 0, length: 0, score: 0 },
                    multiTask: { hits: 0, avgTime: 0, score: 0 },
                    decision: { answers: [], score: 0 }
                },
                psychResults: {},
                preferences: []
            };
            
            initPsychTest();
            initDecisionTest();
            
            updateTestProgress();
            showPage('comprehensive-test');
            showTestStep(1);
        }

        function showTestStep(step) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ —à–∞–≥–∏
            for (let i = 1; i <= 9; i++) {
                const stepEl = document.getElementById(`test-step-${i}`);
                if (stepEl) stepEl.classList.add('hidden');
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π —à–∞–≥
            document.getElementById(`test-step-${step}`).classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
            updateTestProgress();
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('prev-btn').style.display = step > 1 ? 'flex' : 'none';
            
            if (step === 9) {
                document.getElementById('next-btn').innerHTML = '<i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å';
                document.getElementById('next-btn').onclick = finishTest;
            } else {
                document.getElementById('next-btn').innerHTML = '<i class="fas fa-arrow-right"></i> –î–∞–ª–µ–µ';
                document.getElementById('next-btn').onclick = nextTestStep;
            }
        }

        function updateTestProgress() {
            const progress = `–®–∞–≥ ${currentState.currentStep} –∏–∑ ${currentState.totalSteps}`;
            document.getElementById('test-progress').textContent = progress;
        }

        function nextTestStep() {
            saveCurrentStepData();
            
            if (currentState.currentStep < currentState.totalSteps) {
                currentState.currentStep++;
                showTestStep(currentState.currentStep);
            }
        }

        function prevTestStep() {
            if (currentState.currentStep > 1) {
                currentState.currentStep--;
                showTestStep(currentState.currentStep);
            }
        }

        function saveCurrentStepData() {
            switch(currentState.currentStep) {
                case 1:
                    currentState.testData.personal = {
                        name: document.getElementById('user-name-input').value,
                        age: parseInt(document.getElementById('user-age').value) || 0,
                        height: parseInt(document.getElementById('user-height').value) || 0,
                        weight: parseInt(document.getElementById('user-weight').value) || 0
                    };
                    break;
            }
        }

        function toggleOption(button, value) {
            button.classList.toggle('selected');
            
            if (button.classList.contains('selected')) {
                if (!currentState.testData.preferences.includes(value)) {
                    currentState.testData.preferences.push(value);
                }
            } else {
                const index = currentState.testData.preferences.indexOf(value);
                if (index > -1) {
                    currentState.testData.preferences.splice(index, 1);
                }
            }
        }

        // –ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
        function initPsychTest() {
            const container = document.getElementById('psych-test-container');
            container.innerHTML = '';
            
            PSYCH_QUESTIONS.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'analysis-card';
                questionDiv.innerHTML = `
                    <h4>–í–æ–ø—Ä–æ—Å ${index + 1}: ${q.question}</h4>
                    <div style="margin-top: 10px;">
                        ${q.options.map((option, optIndex) => `
                            <button class="scenario-option" onclick="selectPsychOption(${index}, ${optIndex})">
                                ${option.text}
                            </button>
                        `).join('')}
                    </div>
                `;
                container.appendChild(questionDiv);
            });
        }

        function selectPsychOption(questionIndex, optionIndex) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
            alert('–ü—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç: –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –¢–µ—Å—Ç –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π
        function initDecisionTest() {
            const container = document.getElementById('decision-test-container');
            container.innerHTML = '';
            
            DECISION_QUESTIONS.forEach((q, index) => {
                const scenarioDiv = document.createElement('div');
                scenarioDiv.className = 'analysis-card';
                scenarioDiv.innerHTML = `
                    <h4>–°–∏—Ç—É–∞—Ü–∏—è ${index + 1}: ${q.question}</h4>
                    <div style="margin-top: 10px;">
                        ${q.options.map((option, optIndex) => `
                            <button class="scenario-option" onclick="selectDecisionOption(${index}, ${optIndex})">
                                ${option.text}
                            </button>
                        `).join('')}
                    </div>
                `;
                container.appendChild(scenarioDiv);
            });
        }

        function selectDecisionOption(questionIndex, optionIndex) {
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
            alert('–¢–µ—Å—Ç —Ä–µ—à–µ–Ω–∏–π: –æ—Ç–≤–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω');
        }

        // –¢–ï–°–¢ 1: –ó—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è
        let visualReactionTest = {
            startTime: null,
            times: [],
            testCount: 0,
            maxTests: 3,
            timeoutId: null,
            isRunning: false
        };

        function startVisualReactionTest() {
            if (visualReactionTest.isRunning) return;
            
            visualReactionTest.isRunning = true;
            visualReactionTest.times = [];
            visualReactionTest.testCount = 0;
            
            document.getElementById('start-visual-reaction').classList.add('hidden');
            document.getElementById('visual-reaction-results').classList.add('hidden');
            document.getElementById('visual-reaction-target').classList.remove('disabled');
            document.getElementById('visual-reaction-timer').textContent = "–ñ–¥–∏—Ç–µ...";
            
            setTimeout(startVisualReactionRound, 1000);
        }

        function startVisualReactionRound() {
            if (visualReactionTest.testCount >= visualReactionTest.maxTests) {
                finishVisualReactionTest();
                return;
            }
            
            document.getElementById('visual-reaction-target').classList.remove('active');
            document.getElementById('visual-reaction-target').style.backgroundColor = '#cccccc';
            document.getElementById('visual-reaction-timer').textContent = "–ñ–¥–∏—Ç–µ...";
            
            const delay = 1000 + Math.random() * 2000;
            
            visualReactionTest.timeoutId = setTimeout(() => {
                visualReactionTest.startTime = Date.now();
                document.getElementById('visual-reaction-target').classList.add('active');
                document.getElementById('visual-reaction-target').style.backgroundColor = '#ff6b6b';
                document.getElementById('visual-reaction-timer').textContent = "–ñ–ú–ò!";
            }, delay);
        }

        function recordVisualReaction() {
            if (!visualReactionTest.startTime || !visualReactionTest.isRunning) return;
            
            const reactionTime = Date.now() - visualReactionTest.startTime;
            visualReactionTest.times.push(reactionTime);
            visualReactionTest.testCount++;
            
            document.getElementById('visual-reaction-timer').textContent = `${reactionTime} –º—Å`;
            document.getElementById('visual-reaction-target').style.backgroundColor = '#4caf50';
            
            updateVisualReactionResults();
            
            setTimeout(startVisualReactionRound, 1000);
        }

        function updateVisualReactionResults() {
            const resultsDiv = document.getElementById('visual-reaction-times');
            resultsDiv.innerHTML = '';
            
            visualReactionTest.times.forEach((time, index) => {
                resultsDiv.innerHTML += `<div>–ü–æ–ø—ã—Ç–∫–∞ ${index + 1}: ${time} –º—Å</div>`;
            });
            
            if (visualReactionTest.times.length > 0) {
                const avg = visualReactionTest.times.reduce((a, b) => a + b, 0) / visualReactionTest.times.length;
                document.getElementById('avg-visual-reaction').textContent = avg.toFixed(0);
                
                const score = calculateReactionScore(avg);
                document.getElementById('visual-reaction-score').textContent = `${score}/10`;
                currentState.testData.testResults.visualReaction.score = score;
                currentState.testData.testResults.visualReaction.average = avg;
                currentState.testData.testResults.visualReaction.times = visualReactionTest.times;
            }
        }

        function finishVisualReactionTest() {
            visualReactionTest.isRunning = false;
            clearTimeout(visualReactionTest.timeoutId);
            
            document.getElementById('visual-reaction-target').classList.add('disabled');
            document.getElementById('visual-reaction-target').style.backgroundColor = '#cccccc';
            document.getElementById('visual-reaction-timer').textContent = "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω";
            document.getElementById('visual-reaction-results').classList.remove('hidden');
            document.getElementById('start-visual-reaction').classList.remove('hidden');
        }

        // –¢–ï–°–¢ 2: –°–ª—É—Ö–æ–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è
        let soundReactionTest = {
            startTime: null,
            times: [],
            testCount: 0,
            maxTests: 3,
            timeoutId: null,
            isRunning: false
        };

        function startSoundReactionTest() {
            if (soundReactionTest.isRunning) return;
            
            soundReactionTest.isRunning = true;
            soundReactionTest.times = [];
            soundReactionTest.testCount = 0;
            
            document.getElementById('start-sound-reaction').classList.add('hidden');
            document.getElementById('sound-reaction-results').classList.add('hidden');
            document.getElementById('sound-reaction-timer').textContent = "–ñ–¥–∏—Ç–µ –∑–≤—É–∫–∞...";
            
            setTimeout(startSoundReactionRound, 1000);
        }

        function startSoundReactionRound() {
            if (soundReactionTest.testCount >= soundReactionTest.maxTests) {
                finishSoundReactionTest();
                return;
            }
            
            document.getElementById('sound-reaction-timer').textContent = "–ñ–¥–∏—Ç–µ –∑–≤—É–∫–∞...";
            
            const delay = 1000 + Math.random() * 3000;
            
            soundReactionTest.timeoutId = setTimeout(() => {
                soundReactionTest.startTime = Date.now();
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–≤—É–∫
                document.getElementById('sound-reaction-timer').textContent = "–ó–í–£–ö!";
            }, delay);
        }

        function recordSoundReaction() {
            if (!soundReactionTest.startTime || !soundReactionTest.isRunning) return;
            
            const reactionTime = Date.now() - soundReactionTest.startTime;
            soundReactionTest.times.push(reactionTime);
            soundReactionTest.testCount++;
            
            document.getElementById('sound-reaction-timer').textContent = `${reactionTime} –º—Å`;
            
            updateSoundReactionResults();
            
            setTimeout(startSoundReactionRound, 1000);
        }

        function updateSoundReactionResults() {
            const resultsDiv = document.getElementById('sound-reaction-times');
            resultsDiv.innerHTML = '';
            
            soundReactionTest.times.forEach((time, index) => {
                resultsDiv.innerHTML += `<div>–ü–æ–ø—ã—Ç–∫–∞ ${index + 1}: ${time} –º—Å</div>`;
            });
            
            if (soundReactionTest.times.length > 0) {
                const avg = soundReactionTest.times.reduce((a, b) => a + b, 0) / soundReactionTest.times.length;
                document.getElementById('avg-sound-reaction').textContent = avg.toFixed(0);
                
                const score = calculateReactionScore(avg);
                document.getElementById('sound-reaction-score').textContent = `${score}/10`;
                currentState.testData.testResults.soundReaction.score = score;
                currentState.testData.testResults.soundReaction.average = avg;
                currentState.testData.testResults.soundReaction.times = soundReactionTest.times;
            }
        }

        function finishSoundReactionTest() {
            soundReactionTest.isRunning = false;
            clearTimeout(soundReactionTest.timeoutId);
            
            document.getElementById('sound-reaction-timer').textContent = "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω";
            document.getElementById('sound-reaction-results').classList.remove('hidden');
            document.getElementById('start-sound-reaction').classList.remove('hidden');
        }

        // –¢–ï–°–¢ 3: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è
        let coordinationTest = {
            isRunning: false,
            startTime: null,
            totalTime: 0,
            hits: 0,
            misses: 0,
            target: null,
            area: null,
            intervalId: null
        };

        function startCoordinationTest() {
            if (coordinationTest.isRunning) return;
            
            coordinationTest.isRunning = true;
            coordinationTest.startTime = Date.now();
            coordinationTest.totalTime = 0;
            coordinationTest.hits = 0;
            coordinationTest.misses = 0;
            
            document.getElementById('start-coordination').classList.add('hidden');
            document.getElementById('coordination-results').classList.add('hidden');
            
            coordinationTest.area = document.getElementById('coordination-area');
            coordinationTest.target = document.getElementById('coordination-target');
            
            coordinationTest.target.style.left = '50%';
            coordinationTest.target.style.top = '50%';
            coordinationTest.target.style.backgroundColor = '#4caf50';
            coordinationTest.target.style.width = '60px';
            coordinationTest.target.style.height = '60px';
            
            // –ù–∞—á–∞–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            let x = 50, y = 50;
            let dx = 2, dy = 1.5;
            
            coordinationTest.intervalId = setInterval(() => {
                if (!coordinationTest.isRunning) return;
                
                coordinationTest.totalTime = (Date.now() - coordinationTest.startTime) / 1000;
                document.getElementById('coordination-timer').textContent = coordinationTest.totalTime.toFixed(1) + ' —Å–µ–∫';
                
                x += dx;
                y += dy;
                
                if (x < 5 || x > 95) dx = -dx;
                if (y < 5 || y > 95) dy = -dy;
                
                coordinationTest.target.style.left = x + '%';
                coordinationTest.target.style.top = y + '%';
                
                if (coordinationTest.totalTime >= 10) {
                    finishCoordinationTest();
                }
            }, 50);
            
            // –¢—Ä–µ–∫–∏–Ω–≥ –º—ã—à–∏
            coordinationTest.area.addEventListener('mousemove', trackMousePosition);
            coordinationTest.area.addEventListener('touchmove', trackTouchPosition, { passive: true });
        }

        function trackMousePosition(e) {
            if (!coordinationTest.isRunning) return;
            
            const target = coordinationTest.target;
            const area = coordinationTest.area;
            
            const targetRect = target.getBoundingClientRect();
            const areaRect = area.getBoundingClientRect();
            const mouseX = e.clientX - areaRect.left;
            const mouseY = e.clientY - areaRect.top;
            
            const isInside = Math.sqrt(
                Math.pow(mouseX - (targetRect.left + targetRect.width/2 - areaRect.left), 2) +
                Math.pow(mouseY - (targetRect.top + targetRect.height/2 - areaRect.top), 2)
            ) <= targetRect.width / 2;
            
            if (isInside) {
                coordinationTest.hits++;
                target.style.backgroundColor = '#ff6b6b';
            } else {
                coordinationTest.misses++;
                target.style.backgroundColor = '#4caf50';
            }
            
            const accuracy = coordinationTest.hits > 0 ? 
                Math.min((coordinationTest.hits / (coordinationTest.hits + coordinationTest.misses)) * 100, 100) : 0;
            document.getElementById('coordination-accuracy').textContent = accuracy.toFixed(1);
        }

        function trackTouchPosition(e) {
            if (!coordinationTest.isRunning) return;
            const touch = e.touches[0];
            const fakeEvent = {
                clientX: touch.clientX,
                clientY: touch.clientY
            };
            trackMousePosition(fakeEvent);
        }

        function finishCoordinationTest() {
            if (!coordinationTest.isRunning) return;
            
            coordinationTest.isRunning = false;
            clearInterval(coordinationTest.intervalId);
            
            const totalTime = coordinationTest.totalTime;
            const accuracy = coordinationTest.hits > 0 ? 
                Math.min((coordinationTest.hits / (coordinationTest.hits + coordinationTest.misses)) * 100, 100) : 0;
            
            document.getElementById('coordination-time').textContent = totalTime.toFixed(1);
            document.getElementById('coordination-accuracy').textContent = accuracy.toFixed(1);
            
            const timeScore = Math.min(totalTime, 10);
            const accuracyScore = accuracy / 10;
            const totalScore = Math.round((timeScore * 0.3 + accuracyScore * 0.7) * 10) / 10;
            
            document.getElementById('coordination-score').textContent = `${totalScore.toFixed(1)}/10`;
            
            currentState.testData.testResults.coordination.score = totalScore;
            currentState.testData.testResults.coordination.time = totalTime;
            currentState.testData.testResults.coordination.accuracy = accuracy;
            
            document.getElementById('coordination-results').classList.remove('hidden');
            document.getElementById('start-coordination').classList.remove('hidden');
            
            coordinationTest.area.removeEventListener('mousemove', trackMousePosition);
            coordinationTest.area.removeEventListener('touchmove', trackTouchPosition);
        }

        // –¢–ï–°–¢ 4: –ü–∞–º—è—Ç—å
        let sequenceTest = {
            isRunning: false,
            sequence: [],
            userSequence: [],
            level: 1,
            maxLevels: 3,
            currentLevel: 1,
            timeoutId: null
        };

        function startSequenceTest() {
            if (sequenceTest.isRunning) return;
            
            sequenceTest.isRunning = true;
            sequenceTest.sequence = [];
            sequenceTest.userSequence = [];
            sequenceTest.currentLevel = 1;
            
            document.getElementById('start-sequence').classList.add('hidden');
            document.getElementById('sequence-results').classList.add('hidden');
            
            startSequenceLevel();
        }

        function startSequenceLevel() {
            if (sequenceTest.currentLevel > sequenceTest.maxLevels) {
                finishSequenceTest();
                return;
            }
            
            document.getElementById('sequence-timer').textContent = `–£—Ä–æ–≤–µ–Ω—å ${sequenceTest.currentLevel}`;
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            sequenceTest.sequence = [];
            for (let i = 0; i < sequenceTest.currentLevel + 1; i++) {
                sequenceTest.sequence.push(Math.floor(Math.random() * 6) + 1);
            }
            
            sequenceTest.userSequence = [];
            
            // –ü–æ–∫–∞–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
            showSequenceStep(0);
        }

        function showSequenceStep(index) {
            if (index >= sequenceTest.sequence.length) {
                document.getElementById('sequence-timer').textContent = "–í–∞—à–∞ –æ—á–µ—Ä–µ–¥—å!";
                return;
            }
            
            const colorIndex = sequenceTest.sequence[index];
            const box = document.querySelectorAll('.sequence-box')[colorIndex - 1];
            
            box.classList.add('active');
            
            setTimeout(() => {
                box.classList.remove('active');
                setTimeout(() => {
                    showSequenceStep(index + 1);
                }, 300);
            }, 800);
        }

        function checkSequenceAnswer(element, colorIndex) {
            if (!sequenceTest.isRunning) return;
            
            sequenceTest.userSequence.push(colorIndex);
            const currentIndex = sequenceTest.userSequence.length - 1;
            
            if (sequenceTest.userSequence[currentIndex] === sequenceTest.sequence[currentIndex]) {
                element.style.boxShadow = '0 0 20px #34c759';
                
                if (sequenceTest.userSequence.length === sequenceTest.sequence.length) {
                    sequenceTest.currentLevel++;
                    document.getElementById('sequence-timer').textContent = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ!";
                    
                    setTimeout(() => {
                        document.querySelectorAll('.sequence-box').forEach(box => {
                            box.style.boxShadow = '';
                        });
                        startSequenceLevel();
                    }, 1500);
                }
            } else {
                element.style.boxShadow = '0 0 20px #ff3b30';
                setTimeout(() => {
                    finishSequenceTest();
                }, 1000);
            }
        }

        function finishSequenceTest() {
            sequenceTest.isRunning = false;
            clearTimeout(sequenceTest.timeoutId);
            
            document.getElementById('sequence-correct').textContent = sequenceTest.currentLevel - 1;
            document.getElementById('sequence-length').textContent = sequenceTest.currentLevel + 1;
            
            const levelScore = ((sequenceTest.currentLevel - 1) / sequenceTest.maxLevels) * 10;
            const totalScore = Math.round(levelScore * 10) / 10;
            
            document.getElementById('sequence-score').textContent = `${totalScore.toFixed(1)}/10`;
            
            currentState.testData.testResults.sequence.score = totalScore;
            currentState.testData.testResults.sequence.correct = sequenceTest.currentLevel - 1;
            currentState.testData.testResults.sequence.length = sequenceTest.currentLevel + 1;
            
            document.getElementById('sequence-timer').textContent = "–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω";
            document.getElementById('sequence-results').classList.remove('hidden');
            document.getElementById('start-sequence').classList.remove('hidden');
        }

        // –¢–ï–°–¢ 5: –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å
        let multiTaskTest = {
            isRunning: false,
            startTime: null,
            timeLeft: 15,
            targets: [],
            hits: 0,
            intervalId: null
        };

        function startMultiTaskTest() {
            if (multiTaskTest.isRunning) return;
            
            multiTaskTest.isRunning = true;
            multiTaskTest.startTime = Date.now();
            multiTaskTest.timeLeft = 15;
            multiTaskTest.hits = 0;
            multiTaskTest.targets = [];
            
            document.getElementById('start-multi-task').classList.add('hidden');
            document.getElementById('multi-task-results').classList.add('hidden');
            document.getElementById('multi-task-area').innerHTML = '';
            document.getElementById('targets-hit').textContent = '0';
            document.getElementById('multi-task-timer').textContent = '15';
            
            multiTaskTest.intervalId = setInterval(() => {
                multiTaskTest.timeLeft--;
                document.getElementById('multi-task-timer').textContent = multiTaskTest.timeLeft;
                
                if (Math.random() > 0.7) {
                    createTarget();
                }
                
                if (multiTaskTest.timeLeft <= 0) {
                    finishMultiTaskTest();
                }
            }, 1000);
        }

        function createTarget() {
            const area = document.getElementById('multi-task-area');
            const target = document.createElement('div');
            target.className = 'moving-target';
            target.style.backgroundColor = '#ff6b6b';
            target.style.left = Math.random() * 80 + '%';
            target.style.top = Math.random() * 80 + '%';
            target.style.width = '40px';
            target.style.height = '40px';
            
            target.onclick = function() {
                multiTaskTest.hits++;
                document.getElementById('targets-hit').textContent = multiTaskTest.hits;
                target.style.backgroundColor = '#34c759';
                setTimeout(() => {
                    if (target.parentNode) {
                        target.parentNode.removeChild(target);
                    }
                }, 200);
            };
            
            area.appendChild(target);
            multiTaskTest.targets.push(target);
            
            setTimeout(() => {
                if (target.parentNode) {
                    target.parentNode.removeChild(target);
                }
            }, 2000);
        }

        function finishMultiTaskTest() {
            multiTaskTest.isRunning = false;
            clearInterval(multiTaskTest.intervalId);
            
            document.getElementById('multi-task-area').innerHTML = '';
            
            const hitsPerSecond = multiTaskTest.hits / 15;
            const totalScore = Math.min(Math.round(hitsPerSecond * 5), 10);
            
            document.getElementById('multi-task-hit').textContent = multiTaskTest.hits;
            document.getElementById('multi-task-avg-time').textContent = '0';
            document.getElementById('multi-task-score').textContent = `${totalScore}/10`;
            
            currentState.testData.testResults.multiTask.score = totalScore;
            currentState.testData.testResults.multiTask.hits = multiTaskTest.hits;
            
            document.getElementById('multi-task-results').classList.remove('hidden');
            document.getElementById('start-multi-task').classList.remove('hidden');
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function calculateReactionScore(timeMs) {
            if (timeMs < 200) return 10;
            if (timeMs < 300) return 8;
            if (timeMs < 400) return 6;
            if (timeMs < 500) return 4;
            return 2;
        }

        function calculateOverallScore() {
            const scores = currentState.testData.testResults;
            let total = 0;
            let count = 0;
            
            for (const key in scores) {
                if (scores[key].score) {
                    total += scores[key].score;
                    count++;
                }
            }
            
            return count > 0 ? Math.round((total / count) * 10) : 0;
        }

        function finishTest() {
            saveCurrentStepData();
            calculateResults();
            showResultsPage();
        }

        function calculateResults() {
            currentState.testResults = {
                overallScore: calculateOverallScore(),
                timestamp: new Date().toISOString(),
                data: currentState.testData
            };
        }

        function showResultsPage() {
            const results = currentState.testResults;
            const data = currentState.testData;
            
            // –ü—Ä–æ—Ñ–∏–ª—å —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞
            document.getElementById('athlete-profile').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>${data.personal.name || '–ê–Ω–æ–Ω–∏–º'}</h4>
                        <div>–í–æ–∑—Ä–∞—Å—Ç: ${data.personal.age || '‚Äî'}</div>
                        <div>–†–æ—Å—Ç: ${data.personal.height || '‚Äî'} —Å–º</div>
                        <div>–í–µ—Å: ${data.personal.weight || '‚Äî'} –∫–≥</div>
                    </div>
                    <div class="stat-card">
                        <h4>–û–±—â–∏–π –±–∞–ª–ª</h4>
                        <div class="score-display">${results.overallScore}/100</div>
                    </div>
                </div>
            `;
            
            // –§–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
            const testResults = data.testResults;
            document.getElementById('physical-stats').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>–ó—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è</h4>
                        <div class="score-display">${testResults.visualReaction.score.toFixed(1)}/10</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${testResults.visualReaction.score * 10}%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h4>–°–ª—É—Ö–æ–≤–∞—è —Ä–µ–∞–∫—Ü–∏—è</h4>
                        <div class="score-display">${testResults.soundReaction.score.toFixed(1)}/10</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${testResults.soundReaction.score * 10}%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h4>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è</h4>
                        <div class="score-display">${testResults.coordination.score.toFixed(1)}/10</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${testResults.coordination.score * 10}%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h4>–ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å</h4>
                        <div class="score-display">${testResults.multiTask.score.toFixed(1)}/10</div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${testResults.multiTask.score * 10}%"></div>
                        </div>
                    </div>
                </div>
            `;
            
            // –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
            document.getElementById('sport-recommendations').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>‚öΩ –§—É—Ç–±–æ–ª</h4>
                        <div class="score-display">${Math.round(Math.random() * 30) + 70}%</div>
                        <div style="font-size: 12px;">–•–æ—Ä–æ—à–∞—è —Ä–µ–∞–∫—Ü–∏—è –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è</div>
                    </div>
                    <div class="stat-card">
                        <h4>üèÄ –ë–∞—Å–∫–µ—Ç–±–æ–ª</h4>
                        <div class="score-display">${Math.round(Math.random() * 30) + 60}%</div>
                        <div style="font-size: 12px;">–•–æ—Ä–æ—à–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</div>
                    </div>
                </div>
            `;
            
            showPage('results');
        }

        function saveResults() {
            const results = currentState.testResults;
            
            if (currentState.testData.personal.name) {
                localStorage.setItem('userName', currentState.testData.personal.name);
                document.getElementById('user-name').textContent = currentState.testData.personal.name;
            }
            
            let savedData = JSON.parse(localStorage.getItem('sportsAnalyzerData')) || {};
            savedData.lastTest = results;
            savedData.testHistory = savedData.testHistory || [];
            savedData.testHistory.push(results);
            
            localStorage.setItem('sportsAnalyzerData', JSON.stringify(savedData));
            
            document.getElementById('user-score').textContent = `${results.overallScore}/100`;
            document.getElementById('initial-test-alert').style.display = 'none';
            
            alert('‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
            showPage('welcome');
        }

        function restartTest() {
            if (confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç?')) {
                startComprehensiveTest();
            }
        }

        function displayTestHistory() {
            const savedData = JSON.parse(localStorage.getItem('sportsAnalyzerData'));
            const history = savedData?.testHistory || [];
            const container = document.getElementById('results-history');
            
            if (history.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-light);">
                        <i class="fas fa-clipboard-list" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <h3>–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–æ–≤ –ø—É—Å—Ç–∞</h3>
                        <p>–ü—Ä–æ–π–¥–∏—Ç–µ –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç!</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="stats-grid">';
            
            history.reverse().forEach((test, index) => {
                const date = new Date(test.timestamp).toLocaleDateString();
                
                html += `
                    <div class="stat-card" onclick="showTestDetails(${history.length - 1 - index})">
                        <h4>–¢–µ—Å—Ç –æ—Ç ${date}</h4>
                        <div class="score-display">${test.overallScore}/100</div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function showTestDetails(index) {
            const savedData = JSON.parse(localStorage.getItem('sportsAnalyzerData'));
            const test = savedData.testHistory[index];
            alert(`–¢–µ—Å—Ç –æ—Ç ${new Date(test.timestamp).toLocaleDateString()}\n\n–û–±—â–∏–π –±–∞–ª–ª: ${test.overallScore}/100`);
        }

        function selectSport(sport) {
            currentState.currentSport = sport;
            const sportData = SPORTS_DATA[sport];
            
            document.getElementById('sport-analysis-title').textContent = `–ê–Ω–∞–ª–∏–∑: ${sportData.name}`;
            
            const container = document.getElementById('sport-analysis-content');
            container.innerHTML = `
                <h3>${sportData.name}</h3>
                <div class="stats-grid" style="margin-top: 20px;">
                    ${sportData.positions.map(pos => `
                        <div class="stat-card">
                            <h4>${pos.name}</h4>
                            <div class="score-display">${Math.round(Math.random() * 30) + 60}%</div>
                        </div>
                    `).join('')}
                </div>
                <div class="analysis-card" style="margin-top: 20px;">
                    <h4>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:</h4>
                    <p>‚Ä¢ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ 3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</p>
                    <p>‚Ä¢ –£–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—é</p>
                    <p>‚Ä¢ –ò–∑—É—á–µ–Ω–∏–µ —Ç–∞–∫—Ç–∏–∫–∏ –∏–≥—Ä—ã</p>
                </div>
            `;
            
            showPage('sport-analysis');
        }

        // –ú–∏–Ω–∏-–∏–≥—Ä—ã
        function startReactionGame() {
            alert('üéÆ –ò–≥—Ä–∞ "–†–µ–∞–∫—Ü–∏—è" –∑–∞–ø—É—â–µ–Ω–∞!\n–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ –ø–æ—è–≤–ª—è—é—â–∏–º—Å—è —Ü–µ–ª—è–º!');
        }

        function startCoordinationGame() {
            alert('üéØ –ò–≥—Ä–∞ "–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è" –∑–∞–ø—É—â–µ–Ω–∞!\n–ü–æ–ø–∞–¥–∞–π—Ç–µ –≤ –¥–≤–∏–∂—É—â–∏–µ—Å—è —Ü–µ–ª–∏!');
        }

        function startMemoryGame() {
            alert('üß† –ò–≥—Ä–∞ "–ü–∞–º—è—Ç—å" –∑–∞–ø—É—â–µ–Ω–∞!\n–ó–∞–ø–æ–º–∏–Ω–∞–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!');
        }

        function startStrategyGame() {
            alert('‚ôüÔ∏è –ò–≥—Ä–∞ "–°—Ç—Ä–∞—Ç–µ–≥–∏—è" –∑–∞–ø—É—â–µ–Ω–∞!\n–†–µ—à–∞–π—Ç–µ —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏!');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', initApp);
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π
        document.addEventListener('touchstart', function() {}, {passive: true});
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html>
